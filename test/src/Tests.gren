module Tests exposing (..)

{-|-}

import Bytes.Encode
import Crypto
import Json.Encode
import Task exposing ( Task )


{-|-}
count : Int
count =
    tests (\_ -> {})
        |> Array.length


{-| All of the tests in this module.
-}
tests : (String -> msg) -> Array (Cmd msg)
tests func =
    getSecurecontextTests func
        ++ rsaTests func
        ++ randomValueTests func
        ++ uuidTests func
        ++ hmacKeyTests func
        ++ aesKeyTests func
        ++ ecKeyTests func



-- Secure context


{-|-}
getSecureContext : Task {} Crypto.SecureContext
getSecureContext =
    Crypto.isSecureContext


{-|-}
getSecurecontextTests func =
    let
        testLabel int =
            "Secure context - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 getSecureContext
    ]



-- Random values


{-|-}
randomValueTests : (String -> msg) -> Array (Cmd msg)
randomValueTests func =
    let
        testLabel int =
            "Random value tests - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        testGeneratedValueCount num =
            Task.mapError (\_ -> {})
                >> Task.andThen
                        (\res ->
                            if Array.length res == num then
                                Task.succeed {}
                            else
                                Task.fail {}
                        )
    in
    [ success 1 (Crypto.getRandomInt8Values 3)
    , success 2 (Crypto.getRandomInt8Values 99999)
    , success 3 (Crypto.getRandomInt8Values -99999)
    , success 4 (Crypto.getRandomUInt8Values 3)
    , success 5 (Crypto.getRandomUInt8Values 99999)
    , success 6 (Crypto.getRandomUInt8Values -99999)
    , success 7 (Crypto.getRandomInt16Values 3)
    , success 8 (Crypto.getRandomInt16Values 99999)
    , success 9 (Crypto.getRandomInt16Values -99999)
    , success 10 (Crypto.getRandomUInt16Values 3)
    , success 11 (Crypto.getRandomUInt16Values 99999)
    , success 12 (Crypto.getRandomUInt16Values -99999)
    , success 13 (Crypto.getRandomInt32Values 3)
    , success 14 (Crypto.getRandomInt32Values 99999)
    , success 15 (Crypto.getRandomInt32Values -99999)
    , success 16 (Crypto.getRandomUInt32Values 3)
    , success 17 (Crypto.getRandomUInt32Values 99999)
    , success 18 (Crypto.getRandomUInt32Values -99999)
        {- Testing to make sure the max and min of generated values is respected, even
        when the number of values requested is higher (or lower) than the max value
        -}
    , success 19 (testGeneratedValueCount 0 (Crypto.getRandomUInt32Values -99999))
    , success 20 (testGeneratedValueCount 16384 (Crypto.getRandomUInt32Values 99999))
    , success 21 (testGeneratedValueCount 0 (Crypto.getRandomUInt16Values -99999))
    , success 22 (testGeneratedValueCount 32768 (Crypto.getRandomUInt16Values 99999))
    , success 23 (testGeneratedValueCount 0 (Crypto.getRandomUInt8Values -99999))
    , success 24 (testGeneratedValueCount 65536 (Crypto.getRandomUInt8Values 99999))
    ]



-- UUID generation


uuidTests : (String -> msg) -> Array (Cmd msg)
uuidTests func =
    let
        testLabel int =
            "Uuid  - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        generateRandomUuid =
            getSecureContext
                |> Task.andThen (\secureContext -> Crypto.randomUuid secureContext)
    in
    [ success 1 generateRandomUuid
    ]



-- RSA KEY TESTS


{-|-}
rsaTests : (String -> msg) -> Array (Cmd msg)
rsaTests func =
    let
        testLabel int =
            "RSA key - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        generate =
            [ success 1 (generateRsaOaepKeyPair Crypto.Sha256 Crypto.PublicExponent65537)
            , success 2 (generateRsaOaepKeyPair Crypto.Sha256 Crypto.PublicExponent3)
            , success 3 (generateRsaOaepKeyPair Crypto.Sha384 Crypto.PublicExponent65537)
            , success 4 (generateRsaOaepKeyPair Crypto.Sha384 Crypto.PublicExponent3)
            , success 5 (generateRsaOaepKeyPair Crypto.Sha512 Crypto.PublicExponent65537)
            , success 6 (generateRsaOaepKeyPair Crypto.Sha512 Crypto.PublicExponent3)
            ]
    in
    generate ++ rsaOaepPublicKeyTests func ++ rsaOaepPrivateKeyTests func ++ rsaPssPublicKeyTests func ++ rsaPssPrivateKeyTests func ++ rsaSsaPkcs1V1_5KPublicKeyTests func ++ rsaSsaPkcs1V1_5KPrivateKeyTests func


{-|-}
rsaOaepPublicKeyTests func =
    let
        testLabel int =
            "RSA-OAEP public key - " ++ String.fromInt int

        failure int =
            expectFailureHelper (testHelper func) (testLabel int)

        exportAsJwk =
            exportRsaKeyTests "RSA-OAEP public key export jwk - " exportRsaOaepPublicKeyAsJwk func

        exportAsSpki =
            exportRsaKeyTests "RSA-OAEP public key export spki - " exportRsaOaepPublicKeyAsSpki func

        importFromJwk =
            importRsaKeyTests "RSA-OAEP public key import jwk - " importRsaOaepPublicKeyFromJwk func

        importFromSpki =
            importRsaKeyTests "RSA-OAEP public key import spki - " importRsaOaepPublicKeyFromSpki func

        importFromSpkiFailures =
            [ failure 31 (importRsaOaepPublicKeyFromSpkiWithArbitraryBytes Crypto.Sha256 Crypto.PublicExponent3 Crypto.Sha256 (Bytes.Encode.encode (Bytes.Encode.string "hello")))
            ]
    in
    exportAsJwk ++ importFromJwk ++ exportAsSpki ++ importFromSpki ++ importFromSpkiFailures


{-|-}
rsaOaepPrivateKeyTests func =
    let
        exportAsJwk =
            exportRsaKeyTests "RSA-OAEP private key export jwk - " exportRsaOaepPrivateKeyAsJwk func

        exportAsPkcs8 =
            exportRsaKeyTests "RSA-OAEP private key export pkcs8 - " exportRsaOaepPrivateKeyAsPkcs8 func

        importFromJwk =
            importRsaKeyTests "RSA-OAEP private key import jwk - " importRsaOaepPrivateKeyFromJwk func

        importFromPkcs8 =
            importRsaKeyTests "RSA-OAEP public key import pkcs8 - " importRsaOaepPrivateKeyFromPkcs8 func
    in
    exportAsJwk ++ exportAsPkcs8 ++ importFromJwk ++ importFromPkcs8


{-|-}
rsaPssPublicKeyTests func =
    let
        exportAsJwk =
            exportRsaKeyTests "RSA-PSS public key export jwk - " exportRsaPssPublicKeyAsJwk func

        exportAsSpki =
            exportRsaKeyTests "RSA-PSS public key export spki - " exportRsaPssPublicKeyAsSpki func

        importAsJwk =
            importRsaKeyTests "RSA-PSS public key import jwk - " importRsaPssPublicKeyFromJwk func

        importAsSpki =
            importRsaKeyTests "RSA-PSS public key import spki - " importRsaPssPublicKeyFromSpki func
    in
    exportAsJwk ++ importAsJwk ++ exportAsSpki ++ importAsSpki


{-|-}
rsaPssPrivateKeyTests func =
    let
        exportAsJwk =
            exportRsaKeyTests "RSA-PSS private key export jwk - " exportRsaPssPrivateKeyAsJwk func

        exportAsPkcs8 =
            exportRsaKeyTests "RSA-PSS private key export pkcs8 - " exportRsaPssPrivateKeyAsPkcs8 func

        importFromJwk =
            importRsaKeyTests "RSA-PSS private key import jwk - " importRsaPssPrivateKeyFromJwk func

        importFromPkcs8 =
            importRsaKeyTests "RSA-PSS private key import pkcs8 - " importRsaPssPrivateKeyFromPkcs8 func
    in
    exportAsJwk ++ exportAsPkcs8 ++ importFromJwk ++ importFromPkcs8


{-|-}
rsaSsaPkcs1V1_5KPublicKeyTests func =
    let
        exportAsJwk =
            exportRsaKeyTests "RSASSA-PKCS1-v1_5 public key export jwk - " exportRsaSsaPkcs1V1_5PublicKeyAsJwk func

        exportAsSpki =
            exportRsaKeyTests "RSASSA-PKCS1-v1_5 public key export spki - " exportRsaSsaPkcs1V1_5PublicKeyAsSpki func

        importAsJwk =
            importRsaKeyTests "RSASSA-PKCS1-v1_5 public key import jwk - " importRsaSsaPkcs1V1_5PublicKeyFromJwk func

        importAsSpki =
            importRsaKeyTests "RSASSA-PKCS1-v1_5 public key import spki - " importRsaSsaPkcs1V1_5PublicKeyFromSpki func
    in
    exportAsJwk ++ importAsJwk ++ exportAsSpki ++ importAsSpki


{-|-}
rsaSsaPkcs1V1_5KPrivateKeyTests func =
    let
        exportAsJwk =
            exportRsaKeyTests "RSASSA-PKCS1-v1_5 public key export jwk - " exportRsaSsaPkcs1V1_5PrivateKeyAsJwk func

        exportAsSpki =
            exportRsaKeyTests "RSASSA-PKCS1-v1_5 public key export spki - " exportRsaSsaPkcs1V1_5PrivateKeyAsPkcs8 func

        importAsJwk =
            importRsaKeyTests "RSASSA-PKCS1-v1_5 public key import jwk - " importRsaSsaPkcs1V1_5PrivateKeyFromJwk func

        importAsSpki =
            importRsaKeyTests "RSASSA-PKCS1-v1_5 public key import spki - " importRsaSsaPkcs1V1_5PrivateKeyFromPkcs8 func
    in
    exportAsJwk ++ importAsJwk ++ exportAsSpki ++ importAsSpki


{-|-}
exportRsaKeyTests string jwkFunc func =
    let
        testLabel int =
            string ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (jwkFunc Crypto.Sha256 Crypto.PublicExponent3)
    , success 2 (jwkFunc Crypto.Sha384 Crypto.PublicExponent3)
    , success 3 (jwkFunc Crypto.Sha512 Crypto.PublicExponent3)
    , success 4 (jwkFunc Crypto.Sha256 Crypto.PublicExponent65537)
    , success 5 (jwkFunc Crypto.Sha384 Crypto.PublicExponent65537)
    , success 6 (jwkFunc Crypto.Sha512 Crypto.PublicExponent65537)
    ]


{-|-}
importRsaKeyTests string jwkFunc func =
    let
        testLabel int =
            string ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (jwkFunc Crypto.Sha256 Crypto.PublicExponent3 Crypto.Sha256)
    , success 2 (jwkFunc Crypto.Sha384 Crypto.PublicExponent3 Crypto.Sha384)
    , success 3 (jwkFunc Crypto.Sha512 Crypto.PublicExponent3 Crypto.Sha512)
    , success 4 (jwkFunc Crypto.Sha256 Crypto.PublicExponent65537 Crypto.Sha256)
    , success 5 (jwkFunc Crypto.Sha384 Crypto.PublicExponent65537 Crypto.Sha384)
    , success 6 (jwkFunc Crypto.Sha512 Crypto.PublicExponent65537 Crypto.Sha512)
    ]



-- AES KEY TESTS


{-|-}
exportAesKeyTests func =
    let
        testLabel int =
            "AES export key tests - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (exportAesCtrKeyAsJwk Crypto.AesLength128)
    , success 2 (exportAesCtrKeyAsJwk Crypto.AesLength256)
    , success 3 (exportAesCtrKeyAsRaw Crypto.AesLength128)
    , success 4 (exportAesCtrKeyAsRaw Crypto.AesLength256)
    , success 5 (exportAesCbcKeyAsJwk Crypto.AesLength128)
    , success 6 (exportAesCbcKeyAsJwk Crypto.AesLength256)
    , success 7 (exportAesCbcKeyAsRaw Crypto.AesLength128)
    , success 8 (exportAesCbcKeyAsRaw Crypto.AesLength256)
    , success 9 (exportAesGcmKeyAsJwk Crypto.AesLength128)
    , success 10 (exportAesGcmKeyAsJwk Crypto.AesLength256)
    , success 11 (exportAesGcmKeyAsRaw Crypto.AesLength128)
    , success 12 (exportAesGcmKeyAsRaw Crypto.AesLength256)
    ]


{-|-}
importAesKeyTests func =
    let
        testLabel int =
            "AES import key tests - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (importAesCtrKeyFromJwk Crypto.AesLength128)
    , success 2 (importAesCtrKeyFromJwk Crypto.AesLength256)
    , success 3 (importAesCtrKeyFromRaw Crypto.AesLength128)
    , success 4 (importAesCtrKeyFromRaw Crypto.AesLength256)
    , success 5 (importAesCbcKeyFromJwk Crypto.AesLength128)
    , success 6 (importAesCbcKeyFromJwk Crypto.AesLength256)
    , success 7 (importAesCbcKeyFromRaw Crypto.AesLength128)
    , success 8 (importAesCbcKeyFromRaw Crypto.AesLength256)
    , success 9 (importAesGcmKeyFromJwk Crypto.AesLength128)
    , success 10 (importAesGcmKeyFromJwk Crypto.AesLength256)
    , success 11 (importAesGcmKeyFromRaw Crypto.AesLength128)
    , success 12 (importAesGcmKeyFromRaw Crypto.AesLength256)
    ]


{-|-}
aesKeyTests func =
    exportAesKeyTests func ++ importAesKeyTests func



-- EC KEY TESTS


{-|-}
ecImportKeyTests func =
    let
        testLabel int =
            "EC import key tests - " ++ String.fromInt int

        failure int =
            expectFailureHelper (testHelper func) (testLabel int)
    in
    ecImportKeyTestsHelper func "EC import ecdsa public key from jwk tests" importEcdsaPublicKeyFromJwk
        ++ ecImportKeyTestsHelper func "EC import ecdsa public key from raw tests" importEcdsaPublicKeyFromRaw
        ++ ecImportKeyTestsHelper func "EC import ecdsa public key from spki tests" importEcdsaPublicKeyFromSpki
        ++ ecImportKeyTestsHelper func "EC import ecdsa private key from jwk tests" importEcdsaPrivateKeyFromJwk
        ++ ecImportKeyTestsHelper func "EC import ecdsa private key from pkcs8 tests" importEcdsaPrivateKeyFromPkcs8
        ++ ecImportKeyTestsHelper func "EC import ecdh public key from jwk tests" importEcdhPublicKeyFromJwk
        ++ ecImportKeyTestsHelper func "EC import ecdh public key from raw tests" importEcdhPublicKeyFromRaw
        ++ ecImportKeyTestsHelper func "EC import ecdh public key from spki tests" importEcdhPublicKeyFromSpki
        ++ ecImportKeyTestsHelper func "EC import ecdh private key from jwk tests" importEcdhPrivateKeyFromJwk
        ++ ecImportKeyTestsHelper func "EC import ecdh private key from pkcs8 tests" importEcdhPrivateKeyFromPkcs8
        ++ [ failure 1 (importEcdsaPublicKeyFromJwk Crypto.P521 Crypto.P256 (\_ -> Json.Encode.string "hi"))
            , failure 2 (importEcdsaPublicKeyFromRaw Crypto.P521 Crypto.P256 (\_ -> Bytes.Encode.encode (Bytes.Encode.string "hi")))
            , failure 3 (importEcdsaPublicKeyFromSpki Crypto.P521 Crypto.P256 (\_ -> Bytes.Encode.encode (Bytes.Encode.string "hi")))
            , failure 4 (importEcdsaPrivateKeyFromJwk Crypto.P521 Crypto.P256 (\_ -> Json.Encode.string "hi"))
            ]


{-|-}
ecExportKeyTests func =
    let
        testLabel int =
            "EC export key tests - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (exportEcdhPublicKeyAsJwk Crypto.P256)
    , success 2 (exportEcdhPublicKeyAsJwk Crypto.P384)
    , success 3 (exportEcdhPublicKeyAsJwk Crypto.P521)
    , success 4 (exportEcdhPublicKeyAsRaw Crypto.P256)
    , success 5 (exportEcdhPublicKeyAsRaw Crypto.P384)
    , success 6 (exportEcdhPublicKeyAsRaw Crypto.P521)
    , success 7 (exportEcdhPublicKeyAsSpki Crypto.P256)
    , success 8 (exportEcdhPublicKeyAsSpki Crypto.P384)
    , success 9 (exportEcdhPublicKeyAsSpki Crypto.P521)
    , success 10 (exportEcdsaPublicKeyAsJwk Crypto.P256)
    , success 11 (exportEcdsaPublicKeyAsJwk Crypto.P384)
    , success 12 (exportEcdsaPublicKeyAsJwk Crypto.P521)
    , success 13 (exportEcdsaPublicKeyAsRaw Crypto.P256)
    , success 14 (exportEcdsaPublicKeyAsRaw Crypto.P384)
    , success 15 (exportEcdsaPublicKeyAsRaw Crypto.P521)
    , success 16 (exportEcdsaPublicKeyAsSpki Crypto.P256)
    , success 17 (exportEcdsaPublicKeyAsSpki Crypto.P384)
    , success 18 (exportEcdsaPublicKeyAsSpki Crypto.P521)
    , success 19 (exportEcdhPrivateKeyAsJwk Crypto.P256)
    , success 20 (exportEcdhPrivateKeyAsJwk Crypto.P384)
    , success 21 (exportEcdhPrivateKeyAsJwk Crypto.P521)
    , success 22 (exportEcdhPrivateKeyAsPkcs8 Crypto.P256)
    , success 23 (exportEcdhPrivateKeyAsPkcs8 Crypto.P384)
    , success 24 (exportEcdhPrivateKeyAsPkcs8 Crypto.P521)
    , success 25 (exportEcdsaPrivateKeyAsJwk Crypto.P256)
    , success 26 (exportEcdsaPrivateKeyAsJwk Crypto.P384)
    , success 27 (exportEcdsaPrivateKeyAsJwk Crypto.P521)
    , success 28 (exportEcdsaPrivateKeyAsPkcs8 Crypto.P256)
    , success 29 (exportEcdsaPrivateKeyAsPkcs8 Crypto.P384)
    , success 30 (exportEcdsaPrivateKeyAsPkcs8 Crypto.P521)
    ]


{-|-}
ecKeyTests func =
    ecExportKeyTests func ++ ecImportKeyTests func


{-|-}
ecImportKeyTestsHelper func string exportFunc =
    let
        testLabel int =
            string ++ " - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        failure int =
            expectFailureHelper (testHelper func) (testLabel int)
    in
    [ success 1 (exportFunc Crypto.P256 Crypto.P256 identity)
    , failure 2 (exportFunc Crypto.P256 Crypto.P384 identity)
    , failure 3 (exportFunc Crypto.P256 Crypto.P521 identity)
    , failure 4 (exportFunc Crypto.P384 Crypto.P256 identity)
    , success 5 (exportFunc Crypto.P384 Crypto.P384 identity)
    , failure 6 (exportFunc Crypto.P384 Crypto.P521 identity)
    , failure 7 (exportFunc Crypto.P521 Crypto.P256 identity)
    , failure 8 (exportFunc Crypto.P521 Crypto.P384 identity)
    , success 9 (exportFunc Crypto.P521 Crypto.P521 identity)
    ]



-- HMAC KEY TESTS


{-| Importing HMAC keys from JWK tests
-}
hmacImportKeyFromJwkTests func =
    let
        testLabel int =
            "HMAC import key from JWK test - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        failure int =
            expectFailureHelper (testHelper func) (testLabel int)
    in
    [ success 1 (importHmacKeyFromJwk Crypto.Sha256 Nothing Crypto.Sha256 Nothing)
    , failure 2 (importHmacKeyFromJwk Crypto.Sha256 Nothing Crypto.Sha384 Nothing)
    , failure 3 (importHmacKeyFromJwk Crypto.Sha256 Nothing Crypto.Sha512 Nothing)
    , failure 4 (importHmacKeyFromJwk Crypto.Sha384 Nothing Crypto.Sha256 Nothing)
    , success 5 (importHmacKeyFromJwk Crypto.Sha384 Nothing Crypto.Sha384 Nothing)
    , failure 6 (importHmacKeyFromJwk Crypto.Sha384 Nothing Crypto.Sha512 Nothing)
    , failure 7 (importHmacKeyFromJwk Crypto.Sha512 Nothing Crypto.Sha256 Nothing)
    , failure 8 (importHmacKeyFromJwk Crypto.Sha512 Nothing Crypto.Sha384 Nothing)
    , success 9 (importHmacKeyFromJwk Crypto.Sha512 Nothing Crypto.Sha512 Nothing)
    ]


{-| Importing HMAC keys from raw tests
-}
hmacImportKeyFromRawTests func =
    let
        testLabel int =
            "HMAC import key from raw test - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)
    in
    [ success 1 (importHmacKeyFromRaw Crypto.Sha256 Nothing Crypto.Sha256 Nothing)
    , success 2 (importHmacKeyFromRaw Crypto.Sha256 Nothing Crypto.Sha384 Nothing)
    , success 3 (importHmacKeyFromRaw Crypto.Sha256 Nothing Crypto.Sha512 Nothing)
    , success 4 (importHmacKeyFromRaw Crypto.Sha384 Nothing Crypto.Sha256 Nothing)
    , success 5 (importHmacKeyFromRaw Crypto.Sha384 Nothing Crypto.Sha384 Nothing)
    , success 6 (importHmacKeyFromRaw Crypto.Sha384 Nothing Crypto.Sha512 Nothing)
    , success 7 (importHmacKeyFromRaw Crypto.Sha512 Nothing Crypto.Sha256 Nothing)
    , success 8 (importHmacKeyFromRaw Crypto.Sha512 Nothing Crypto.Sha384 Nothing)
    , success 9 (importHmacKeyFromRaw Crypto.Sha512 Nothing Crypto.Sha512 Nothing)
    ]


{-| Tests for importing HMAC keys.

Note that these tests do _not_ test for importing keys with different lengths. This is
because of inconsistencies between results on `browser` and `node` platforms. The docs
in `gren-core` mention this.
-}
hmacImportKeyTests func =
    hmacImportKeyFromRawTests func ++ hmacImportKeyFromJwkTests func


{-|-}
hmacExportKeyTests func =
    let
        testLabel int =
            "HMAC export key tests - " ++ String.fromInt int

        success int =
            expectSuccessHelper (testHelper func) (testLabel int)

        failure int =
            expectFailureHelper (testHelper func) (testLabel int)
    in
    [ success 1 (exportHmacKeyAsJwk Crypto.Sha256 Nothing)
    , success 2 (exportHmacKeyAsJwk Crypto.Sha384 Nothing)
    , success 3 (exportHmacKeyAsJwk Crypto.Sha512 Nothing)
        -- Exactly 8, which is the minimum value and should succeed
    , success 4 (exportHmacKeyAsJwk Crypto.Sha256 (Just 8))
    , success 5 (exportHmacKeyAsJwk Crypto.Sha384 (Just 8))
    , success 6 (exportHmacKeyAsJwk Crypto.Sha512 (Just 8))
        -- Less than 8, but clamped to at least 8 (which results in success)
    , success 7 (exportHmacKeyAsJwk Crypto.Sha256 (Just 1))
    , success 8 (exportHmacKeyAsJwk Crypto.Sha384 (Just 1))
    , success 9 (exportHmacKeyAsJwk Crypto.Sha512 (Just 1))
        -- A number not divible by 8
    , failure 10 (exportHmacKeyAsJwk Crypto.Sha256 (Just 14))
    , failure 11 (exportHmacKeyAsJwk Crypto.Sha384 (Just 14))
    , failure 12 (exportHmacKeyAsJwk Crypto.Sha512 (Just 14))
        -- Max integer value that can be passed for the `length`, but is still divisible by 8
    , success 13 (exportHmacKeyAsJwk Crypto.Sha256 (Just 2048))
    , success 14 (exportHmacKeyAsJwk Crypto.Sha384 (Just 2048))
    , success 15 (exportHmacKeyAsJwk Crypto.Sha512 (Just 2048))
        -- Greater than the max integer value, should still succeed with clamped value
    , success 16 (exportHmacKeyAsJwk Crypto.Sha256 (Just 41313431134))
    , success 17 (exportHmacKeyAsJwk Crypto.Sha384 (Just 41313431134))
    , success 18 (exportHmacKeyAsJwk Crypto.Sha512 (Just 41313431134))
    ]


{-| All HMAC key tests
-}
hmacKeyTests func =
    hmacExportKeyTests func ++ hmacImportKeyTests func



-- GENERATE KEYS


{-|-}
generateRsaOaepKeyPair hash exponent =
    generateKey
        Crypto.ModulusLengthNotDivisibleByEight
        (\secureContext ->
            Crypto.generateRsaOaepKeyPair
                secureContext
                { modulusLength = 4096
                , hash = hash
                , publicExponent = Crypto.PublicExponent65537
                }
                Crypto.CanBeExtracted
        )


{-|-}
generateRsaPssKeyPair hash exponent =
    generateKey
        Crypto.ModulusLengthNotDivisibleByEight
        (\secureContext ->
            Crypto.generateRsaPssKeyPair
                secureContext
                { modulusLength = 4096
                , hash = hash
                , publicExponent = Crypto.PublicExponent65537
                }
                Crypto.CanBeExtracted
        )


{-|-}
generateRsaSsaPkcs1V1_5KeyPair hash exponent =
    generateKey
        Crypto.ModulusLengthNotDivisibleByEight
        (\secureContext ->
            Crypto.generateRsaSsaPkcs1V1_5KeyPair
                secureContext
                { modulusLength = 4096
                , hash = hash
                , publicExponent = Crypto.PublicExponent65537
                }
                Crypto.CanBeExtracted
        )


{-|-}
generateAesCtrKey aesLength =
    generateKey {} (\secureContext -> Crypto.generateAesCtrKey secureContext aesLength Crypto.CanBeExtracted)


{-|-}
generateAesCbcKey aesLength =
    generateKey {} (\secureContext -> Crypto.generateAesCbcKey secureContext aesLength Crypto.CanBeExtracted)


{-|-}
generateAesGcmKey aesLength =
    generateKey {} (\secureContext -> Crypto.generateAesGcmKey secureContext aesLength Crypto.CanBeExtracted)


{-|-}
generateEcdsaKeyPair curve =
    generateKey {} (\secureContext -> Crypto.generateEcdsaKeyPair secureContext curve Crypto.CanBeExtracted)


{-|-}
generateEcdhKeyPair curve =
    generateKey {} (\secureContext -> Crypto.generateEcdhKeyPair secureContext curve Crypto.CanBeExtracted)


{-|-}
generateHmacKey hash length =
    generateKey
        Crypto.LengthNotDivisibleByEight
        (\secureContext ->
            Crypto.generateHmacKey
                secureContext
                { hash = hash
                , length = length
                }
                Crypto.CanBeExtracted
        )


{-|-}
generateKey errorMap keyGenFunc =
    getSecureContext
        |> Task.mapError (\_ -> errorMap)
        |> Task.andThen
                (\secureContext ->
                    keyGenFunc secureContext
                        |> Task.map
                                (\key ->
                                    { key = key
                                    , secureContext = secureContext
                                    }
                                )
                )



-- EXPORT RSA KEYS


{-|-}
exportRsaOaepPublicKeyAsJwk hash exponent =
    exportRsaOaepKeyPair hash exponent Crypto.exportRsaOaepPublicKeyAsJwk .publicKey


{-|-}
exportRsaOaepPublicKeyAsSpki hash exponent =
    exportRsaOaepKeyPair hash exponent Crypto.exportRsaOaepPublicKeyAsSpki .publicKey


{-|-}
exportRsaOaepPrivateKeyAsJwk hash exponent =
    exportRsaOaepKeyPair hash exponent Crypto.exportRsaOaepPrivateKeyAsJwk .privateKey


{-|-}
exportRsaOaepPrivateKeyAsPkcs8 hash exponent =
    exportRsaOaepKeyPair hash exponent Crypto.exportRsaOaepPrivateKeyAsPkcs8 .privateKey


{-|-}
exportRsaPssPublicKeyAsJwk hash exponent =
    exportRsaPssKeyPair hash exponent Crypto.exportRsaPssPublicKeyAsJwk .publicKey


{-|-}
exportRsaPssPublicKeyAsSpki hash exponent =
    exportRsaPssKeyPair hash exponent Crypto.exportRsaPssPublicKeyAsSpki .publicKey


{-|-}
exportRsaPssPrivateKeyAsJwk hash exponent =
    exportRsaPssKeyPair hash exponent Crypto.exportRsaPssPrivateKeyAsJwk .privateKey


{-|-}
exportRsaPssPrivateKeyAsPkcs8 hash exponent =
    exportRsaPssKeyPair hash exponent Crypto.exportRsaPssPrivateKeyAsPkcs8 .privateKey


{-|-}
exportRsaSsaPkcs1V1_5PublicKeyAsJwk hash exponent =
    exportRsaSsaPkcs1V1_5KeyPair hash exponent Crypto.exportRsaSsaPkcs1V1_5PublicKeyAsJwk .publicKey


{-|-}
exportRsaSsaPkcs1V1_5PublicKeyAsSpki hash exponent =
    exportRsaSsaPkcs1V1_5KeyPair hash exponent Crypto.exportRsaSsaPkcs1V1_5PublicKeyAsSpki .publicKey


{-|-}
exportRsaSsaPkcs1V1_5PrivateKeyAsJwk hash exponent =
    exportRsaSsaPkcs1V1_5KeyPair hash exponent Crypto.exportRsaSsaPkcs1V1_5PrivateKeyAsJwk .privateKey


{-|-}
exportRsaSsaPkcs1V1_5PrivateKeyAsPkcs8 hash exponent =
    exportRsaSsaPkcs1V1_5KeyPair hash exponent Crypto.exportRsaSsaPkcs1V1_5PrivateKeyAsPkcs8 .privateKey


{-|-}
exportRsaOaepKeyPair hash exponent =
    exportKey (generateRsaOaepKeyPair hash exponent)


{-|-}
exportRsaPssKeyPair hash exponent =
    exportKey (generateRsaPssKeyPair hash exponent)


{-|-}
exportRsaSsaPkcs1V1_5KeyPair hash exponent =
    exportKey (generateRsaSsaPkcs1V1_5KeyPair hash exponent)



-- EXPORT EC KEYS


{-|-}
exportEcdsaPrivateKeyAsJwk curve =
    exportEcdsaKeyPair curve Crypto.exportEcdsaPrivateKeyAsJwk .privateKey


{-|-}
exportEcdsaPrivateKeyAsPkcs8 curve =
    exportEcdsaKeyPair curve Crypto.exportEcdsaPrivateKeyAsPkcs8 .privateKey


{-|-}
exportEcdsaPublicKeyAsJwk curve =
    exportEcdsaKeyPair curve Crypto.exportEcdsaPublicKeyAsJwk .publicKey


{-|-}
exportEcdsaPublicKeyAsSpki curve =
    exportEcdsaKeyPair curve Crypto.exportEcdsaPublicKeyAsSpki .publicKey


{-|-}
exportEcdsaPublicKeyAsRaw curve =
    exportEcdsaKeyPair curve Crypto.exportEcdsaPublicKeyAsRaw .publicKey


{-|-}
exportEcdhPrivateKeyAsJwk curve =
    exportEcdhKeyPair curve Crypto.exportEcdhPrivateKeyAsJwk .privateKey


{-|-}
exportEcdhPrivateKeyAsPkcs8 curve =
    exportEcdhKeyPair curve Crypto.exportEcdhPrivateKeyAsPkcs8 .privateKey


{-|-}
exportEcdhPublicKeyAsJwk curve =
    exportEcdhKeyPair curve Crypto.exportEcdhPublicKeyAsJwk .publicKey


{-|-}
exportEcdhPublicKeyAsSpki curve =
    exportEcdhKeyPair curve Crypto.exportEcdhPublicKeyAsSpki .publicKey


{-|-}
exportEcdhPublicKeyAsRaw curve =
    exportEcdhKeyPair curve Crypto.exportEcdhPublicKeyAsRaw .publicKey


{-|-}
exportEcdhKeyPair curve =
    exportKey (generateEcdhKeyPair curve)


{-|-}
exportEcdsaKeyPair curve =
    exportKey (generateEcdsaKeyPair curve)



-- EXPORT HMAC KEYS


{-|-}
exportHmacKeyAsJwk hash length =
    exportHmacKey hash length Crypto.exportHmacKeyAsJwk identity


{-|-}
exportHmacKeyAsRaw hash length =
    exportHmacKey hash length Crypto.exportHmacKeyAsRaw identity


{-|-}
exportHmacKey hash length =
    exportKey (generateHmacKey hash length)



-- EXPORT AES KEYS


{-|-}
exportAesCtrKeyAsJwk aesLength =
    exportAesCtrKey aesLength Crypto.exportAesCtrKeyAsJwk identity


{-|-}
exportAesCtrKeyAsRaw aesLength =
    exportAesCtrKey aesLength Crypto.exportAesCtrKeyAsRaw identity


{-|-}
exportAesCbcKeyAsJwk aesLength =
    exportAesCbcKey aesLength Crypto.exportAesCbcKeyAsJwk identity


{-|-}
exportAesCbcKeyAsRaw aesLength =
    exportAesCbcKey aesLength Crypto.exportAesCbcKeyAsRaw identity


{-|-}
exportAesGcmKeyAsRaw aesLength =
    exportAesGcmKey aesLength Crypto.exportAesGcmKeyAsRaw identity


{-|-}
exportAesGcmKeyAsJwk aesLength =
    exportAesGcmKey aesLength Crypto.exportAesGcmKeyAsJwk identity


{-|-}
exportAesCtrKey aesLength =
    exportKey (generateAesCtrKey aesLength)


{-|-}
exportAesCbcKey aesLength =
    exportKey (generateAesCbcKey aesLength)


{-|-}
exportAesGcmKey aesLength =
    exportKey (generateAesGcmKey aesLength)



-- EXPORT KEY UTILS


{-|-}
exportKey keyGenFunc exportKeyFunc keyFunc =
    keyGenFunc
        |> Task.mapError (\_ -> Crypto.KeyNotExportable)
        |> Task.andThen
                (\{ key, secureContext } ->
                    exportKeyFunc secureContext (keyFunc key)
                        |> Task.map
                                (\exportedKey ->
                                    { key = key
                                    , exportedKey = exportedKey
                                    , secureContext = secureContext
                                    }
                                )
                )



-- IMPORT RSA-OAEP KEYS


{-|-}
importRsaOaepPublicKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPublicKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPublicKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaOaepPublicKeyFromSpki keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPublicKeyAsSpki keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPublicKeyFromSpki
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaOaepPrivateKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPrivateKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPrivateKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaOaepPrivateKeyFromPkcs8 keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPrivateKeyAsPkcs8 keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPrivateKeyFromPkcs8
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaOaepPublicKeyFromJwkWithArbitraryJson keyHash keyExponent importHash json =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPublicKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPublicKeyFromJwk
                secureContext
                json
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaOaepPublicKeyFromSpkiWithArbitraryBytes keyHash keyExponent importHash bytes =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaOaepPublicKeyAsSpki keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaOaepPublicKeyFromSpki
                secureContext
                bytes
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )



-- IMPORT RSA-PSS KEYS


{-|-}
importRsaPssPublicKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaPssPublicKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaPssPublicKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaPssPublicKeyFromSpki keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaPssPublicKeyAsSpki keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaPssPublicKeyFromSpki
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaPssPrivateKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaPssPrivateKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaPssPrivateKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaPssPrivateKeyFromPkcs8 keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaPssPrivateKeyAsPkcs8 keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaPssPrivateKeyFromPkcs8
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )



-- IMPORT RSA-SSA-PKCS1V1.5K KEYS


{-|-}
importRsaSsaPkcs1V1_5PublicKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaSsaPkcs1V1_5PrivateKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaSsaPkcs1V1_5PublicKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaSsaPkcs1V1_5PublicKeyFromSpki keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaSsaPkcs1V1_5PublicKeyAsSpki keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaSsaPkcs1V1_5PublicKeyFromSpki
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaSsaPkcs1V1_5PrivateKeyFromJwk keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaSsaPkcs1V1_5PrivateKeyAsJwk keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaSsaPkcs1V1_5PrivateKeyFromJwk
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )


{-|-}
importRsaSsaPkcs1V1_5PrivateKeyFromPkcs8 keyHash keyExponent importHash =
    importKey
        Crypto.ImportRsaKeyError
        (exportRsaSsaPkcs1V1_5PrivateKeyAsPkcs8 keyHash keyExponent)
        (\{ secureContext, exportedKey } ->
            Crypto.importRsaSsaPkcs1V1_5PrivateKeyFromPkcs8
                secureContext
                exportedKey
                { hash = importHash
                }
                Crypto.CanBeExtracted
        )



-- IMPORT AES KEYS


{-|-}
importAesCtrKeyFromJwk aesLength =
    importKey Crypto.ImportAesKeyError (exportAesCtrKeyAsJwk aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesCtrKeyFromJwk secureContext exportedKey Crypto.CanBeExtracted)


{-|-}
importAesCtrKeyFromRaw aesLength =
    importKey Crypto.ImportAesKeyError (exportAesCtrKeyAsRaw aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesCtrKeyFromRaw secureContext exportedKey Crypto.CanBeExtracted)


{-|-}
importAesCbcKeyFromJwk aesLength =
    importKey Crypto.ImportAesKeyError (exportAesCbcKeyAsJwk aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesCbcKeyFromJwk secureContext exportedKey Crypto.CanBeExtracted)


{-|-}
importAesCbcKeyFromRaw aesLength =
    importKey Crypto.ImportAesKeyError (exportAesCbcKeyAsRaw aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesCbcKeyFromRaw secureContext exportedKey Crypto.CanBeExtracted)


{-|-}
importAesGcmKeyFromJwk aesLength =
    importKey Crypto.ImportAesKeyError (exportAesGcmKeyAsJwk aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesGcmKeyFromJwk secureContext exportedKey Crypto.CanBeExtracted)


{-|-}
importAesGcmKeyFromRaw aesLength =
    importKey Crypto.ImportAesKeyError (exportAesGcmKeyAsRaw aesLength) (\{ secureContext, exportedKey } -> Crypto.importAesGcmKeyFromRaw secureContext exportedKey Crypto.CanBeExtracted)



-- IMPORT ECD KEYS


{-|-}
importEcdsaPublicKeyFromJwk exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdsaPublicKeyAsJwk exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdsaPublicKeyFromJwk secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdsaPublicKeyFromRaw exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdsaPublicKeyAsRaw exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdsaPublicKeyFromRaw secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdsaPublicKeyFromSpki exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdsaPublicKeyAsSpki exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdsaPublicKeyFromSpki secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdsaPrivateKeyFromJwk exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdsaPrivateKeyAsJwk exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdsaPrivateKeyFromJwk secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdsaPrivateKeyFromPkcs8 exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdsaPrivateKeyAsPkcs8 exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdsaPrivateKeyFromPkcs8 secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdhPublicKeyFromJwk exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdhPublicKeyAsJwk exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdhPublicKeyFromJwk secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdhPublicKeyFromRaw exportNamedCurve importNamedCurve key =
    -- Debug.todo ""
    importKey Crypto.ImportEcKeyError (exportEcdhPublicKeyAsRaw exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdhPublicKeyFromRaw secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdhPublicKeyFromSpki exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdhPublicKeyAsSpki exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdhPublicKeyFromSpki secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdhPrivateKeyFromJwk exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdhPrivateKeyAsJwk exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdhPrivateKeyFromJwk secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)


{-|-}
importEcdhPrivateKeyFromPkcs8 exportNamedCurve importNamedCurve key =
    importKey Crypto.ImportEcKeyError (exportEcdhPrivateKeyAsPkcs8 exportNamedCurve) (\{ secureContext, exportedKey } -> Crypto.importEcdhPrivateKeyFromPkcs8 secureContext importNamedCurve (key exportedKey) Crypto.CanBeExtracted)



-- IMPORT HMAC KEYS


{-|-}
importHmacKeyFromJwk keyHash keyExponent importHash importLength =
    importKey Crypto.ImportHmacKeyError (exportHmacKeyAsJwk keyHash keyExponent) (\{ secureContext, exportedKey } -> Crypto.importHmacKeyFromJwk secureContext exportedKey importHash importLength Crypto.CanBeExtracted)


{-|-}
importHmacKeyFromRaw keyHash keyExponent importHash importLength =
    importKey Crypto.ImportHmacKeyError (exportHmacKeyAsRaw keyHash keyExponent) (\{ secureContext, exportedKey } -> Crypto.importHmacKeyFromRaw secureContext exportedKey importHash importLength Crypto.CanBeExtracted)



-- IMPORT KEY UTILS


{-|-}
importKey errorMap exportFunc importFunc =
    exportFunc
        |> Task.mapError (\_ -> errorMap)
        |> Task.andThen
                (\data ->
                    importFunc data
                        |> Task.map
                                (\importedKey ->
                                    { key = data.key
                                    , secureContext = data.secureContext
                                    , exportedKey = data.exportedKey
                                    , importedKey = importedKey
                                    }
                                )
                )



-- Utilities


{-|-}
successString id =
    "✓ - " ++ id


{-|-}
failureString id =
    "x - " ++ id


{-|-}
expectSuccessHelper test id =
    test (successString id) (failureString id)


{-|-}
expectFailureHelper test id =
    test (failureString id) (successString id)


{-|-}
testHelper : (String -> msg) -> String -> String -> Task a b -> Cmd msg
testHelper mapFunc onSuccess onFailure =
    Task.attempt (
        Result.map (\_ -> mapFunc onSuccess)
            >> Result.withDefault (mapFunc onFailure)
    )
